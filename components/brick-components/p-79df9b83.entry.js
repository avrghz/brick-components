import{r as t,h as a,g as i}from"./p-d0f0745a.js";const s=["img","video","picture","[data-bg-image]"].reduce((t,a)=>`${"$$$"===t?"":t+","} ${a}:not([data-loaded=true]):not([data-observed=true])`,"$$$"),e=class{constructor(a){t(this,a),this.getAllElements=t=>t.querySelectorAll(s),this.manageObserver=t=>a=>{a instanceof HTMLElement&&this.getAllElements(a).forEach(async a=>{var i,s;"ADD"===t?a.hasAttribute("data-observed")||a.hasAttribute("data-loaded")||(a.setAttribute("data-observed","true"),null===(i=this.observer)||void 0===i||i.observe(a)):null===(s=this.observer)||void 0===s||s.unobserve(a)})},this.setWatcher=()=>new MutationObserver(t=>t.forEach(t=>{t.addedNodes.forEach(this.manageObserver("ADD")),t.removedNodes.forEach(this.manageObserver("REMOVE"))})),this.is=(t,a)=>"bgImage"===t?a.hasAttribute("data-bg-image"):a.tagName.toLocaleLowerCase()===t,this.resolveImageSource=t=>new Promise((a,i)=>{const s=new Image;s.onload=()=>a(t),s.onerror=()=>i(),s.src=t}),this.setSrc=async(t,a)=>{if(t){const i=t.getAttribute("data-src")||"";t.src=a?i:await this.resolveImageSource(i)}},this.setSrcset=async t=>{t&&t.forEach(t=>t.srcset=t.getAttribute("data-srcset")||"")},this.setVideoSrc=async t=>{t&&t.forEach(t=>t.src=t.getAttribute("data-src")||"")},this.setBackground=async(t,a)=>{if(t){const i=(t.getAttribute("data-bg-image")||"").split(",");a||await this.resolveImageSource(i[0]),t.style.backgroundImage=`url('${i.join("'),url('")}')`}},this.loadMedia=async(t,a=!1)=>{try{this.is("img",t)?await this.setSrc(t,a):this.is("picture",t)?(await this.setSrc(t.querySelector("img"),a),await this.setSrcset(t.querySelectorAll("source"))):this.is("bgImage",t)?await this.setBackground(t,a):this.is("video",t)&&(await this.setVideoSrc(t.querySelectorAll("source")),t.load())}catch(t){}t.setAttribute("data-loaded","true")},this.createObserver=()=>new IntersectionObserver(async(t,a)=>{t.forEach(async t=>{t.isIntersecting&&!t.target.hasAttribute("data-loaded")&&(a.unobserve(t.target),await this.loadMedia(t.target))})},{threshold:0})}componentWillLoad(){"undefined"!=typeof window&&window.IntersectionObserver&&window.MutationObserver&&(this.watcher=this.setWatcher(),this.watcher.observe(this.el,{childList:!0,subtree:!0}),this.observer=this.createObserver())}disconnectedCallback(){var t,a;null===(t=this.observer)||void 0===t||t.disconnect(),null===(a=this.watcher)||void 0===a||a.disconnect()}render(){return a("slot",null)}get el(){return i(this)}};e.style="bk-lazy-media{overflow:hidden;position:relative;display:block}bk-lazy-media img{transition:all 0.5s ease-in-out;transform:scale3d(1.01, 1.01, 1);width:100%;filter:blur(5px)}bk-lazy-media img[data-loaded]{max-width:100%;transform:scale3d(1, 1, 1);filter:blur(0);min-height:auto}";export{e as bk_lazy_media};